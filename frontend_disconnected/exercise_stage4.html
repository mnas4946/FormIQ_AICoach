<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>formIQ - Stage 4 Exercise</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- MediaPipe Pose Detection -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script src="script.js"></script>
</head>
<body class="exercise-body">
    <!-- Exercise Header (Fixed) -->
    <header class="exercise-header">
        <div class="exercise-title-section">
            <span class="stage-tag stage-4">Stage 4 - Near Normal Function</span>
            <h1>Squats</h1>
            <p class="exercise-purpose">Strengthen quadriceps and improve knee stability</p>
        </div>
        <div class="header-actions">
            <!-- Floating Rep Counter (Always Visible) -->
            <div class="floating-rep-counter">
                <span class="rep-label">Reps</span>
                <span class="rep-value" id="floatingReps">0/10</span>
            </div>
            <button class="minimize-panel-btn" id="minimizeBtn" onclick="togglePanel()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path id="toggleIcon" d="M7 10L10 7L13 10M7 14L10 11L13 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span id="panelBtnText">Hide Panel</span>
            </button>
            <button class="cancel-session-btn" onclick="cancelSession()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                End Session
            </button>
        </div>
    </header>

    <!-- Main Exercise View (Full Height, Camera-Focused) -->
    <main class="exercise-main-new">
        <!-- Camera Section (Full Width when panel hidden) -->
        <section class="camera-section-new">
            <div class="camera-view-new">
                <div class="camera-placeholder">
                    <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="60" cy="60" r="60" fill="#E5E7EB"/>
                        <path d="M60 30C43.4315 30 30 43.4315 30 60C30 76.5685 43.4315 90 60 90C76.5685 90 90 76.5685 90 60C90 43.4315 76.5685 30 60 30ZM60 75C51.7157 75 45 68.2843 45 60C45 51.7157 51.7157 45 60 45C68.2843 45 75 51.7157 75 60C75 68.2843 68.2843 75 60 75Z" fill="#9CA3AF"/>
                        <circle cx="60" cy="60" r="8" fill="#6B7280"/>
                    </svg>
                    <p class="camera-text">Camera will appear here</p>
                    <button class="start-camera-btn" onclick="startCamera()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 4L15 10L6 16V4Z" fill="currentColor"/>
                        </svg>
                        Start Camera
                    </button>
                </div>
                
                <!-- Real-time Feedback Overlay -->
                <div class="feedback-overlay" id="feedbackOverlay" style="display: none;">
                    <div class="feedback-content">
                        <p class="feedback-text" id="feedbackText">Keep your back straight and lower yourself slowly</p>
                        <div class="feedback-icon"></div>
                    </div>
                </div>
            </div>

            <!-- Control Buttons (Bottom of camera) -->
            <div class="exercise-controls-new">
                <button class="control-btn-new pause-btn" onclick="togglePause()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 4H6V16H8V4Z" fill="currentColor"/>
                        <path d="M14 4H12V16H14V4Z" fill="currentColor"/>
                    </svg>
                    Pause
                </button>
                <button class="control-btn-new restart-btn" onclick="restartExercise()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 4V10H7M19 16V10H13M17.49 7C16.84 5.34 15.63 3.94 14.05 3.02C12.47 2.1 10.62 1.72 8.79 1.94C6.96 2.16 5.25 2.97 3.93 4.24C2.61 5.51 1.75 7.17 1.49 9M2.51 13C3.16 14.66 4.37 16.06 5.95 16.98C7.53 17.9 9.38 18.28 11.21 18.06C13.04 17.84 14.75 17.03 16.07 15.76C17.39 14.49 18.25 12.83 18.51 11" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Restart
                </button>
                <button class="control-btn-new finish-btn" onclick="showCompletion()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7 10L9 12L13 8M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Finish
                </button>
            </div>
        </section>

        <!-- Collapsible Tracking Panel (Right Side) -->
        <aside class="tracking-panel-new" id="trackingPanel">
            <div class="panel-content">
                <!-- Progress Ring -->
                <div class="progress-ring-section">
                    <div class="progress-ring-container">
                        <svg class="progress-ring" width="120" height="120">
                            <circle cx="60" cy="60" r="52" stroke="#E5E7EB" stroke-width="6" fill="none"/>
                            <circle id="progressCircle" cx="60" cy="60" r="52" stroke="#1e3a8a" stroke-width="6" fill="none" 
                                    stroke-dasharray="327" stroke-dashoffset="327" stroke-linecap="round"/>
                        </svg>
                        <div class="progress-center">
                            <span class="progress-percent" id="progressPercent">0</span>
                            <span class="progress-label">%</span>
                        </div>
                    </div>
                    <p class="progress-text">Session Progress</p>
                </div>

                <!-- Current Exercise Info -->
                <div class="panel-card">
                    <h3 class="panel-card-title">Current Exercise</h3>
                    <p class="panel-card-value">Squats</p>
                    <div class="panel-divider"></div>
                    <div class="panel-detail">
                        <span class="detail-label">Target</span>
                        <span class="detail-value">10 reps Ã— 3 sets</span>
                    </div>
                    <div class="panel-detail">
                        <span class="detail-label">Duration</span>
                        <span class="detail-value" id="durationText">0:00</span>
                    </div>
                </div>

                <!-- Form Feedback -->
                <div class="panel-card">
                    <h3 class="panel-card-title">Form Analysis</h3>
                    <div class="form-status" id="formStatus">
                        <div class="form-indicator good">
                            <div class="indicator-dot"></div>
                            <span>Knee depth: Good</span>
                        </div>
                        <div class="form-indicator good">
                            <div class="indicator-dot"></div>
                            <span>Torso: Straight</span>
                        </div>
                        <div class="form-indicator good">
                            <div class="indicator-dot"></div>
                            <span>Balance: Even</span>
                        </div>
                    </div>
                </div>

                <!-- Next Exercise Preview -->
                <div class="panel-card next-exercise">
                    <div class="next-exercise-header">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 3L12 9L6 15" stroke="#1e3a8a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <h3 class="panel-card-title">Up Next</h3>
                    </div>
                    <p class="next-exercise-name">Push-ups</p>
                    <p class="next-exercise-details">12 reps Ã— 2 sets</p>
                </div>
            </div>
        </aside>
    </main>

    <!-- Completion Modal -->
    <div class="completion-overlay" id="completionOverlay">
        <div class="completion-modal">
            <div class="completion-icon">
                <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="40" cy="40" r="40" fill="#10B981"/>
                    <path d="M25 40L35 50L55 30" stroke="white" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <h2 class="completion-title">Great Progress, Maria! ðŸŽ‰</h2>
            <p class="completion-subtitle">You've completed your rehabilitation session</p>
            
            <div class="completion-stats">
                <div class="completion-stat">
                    <p class="stat-number" id="finalReps">10</p>
                    <p class="stat-label">Reps</p>
                </div>
                <div class="completion-stat">
                    <p class="stat-number" id="finalAccuracy">85%</p>
                    <p class="stat-label">Form</p>
                </div>
                <div class="completion-stat">
                    <p class="stat-number" id="finalDuration">5:23</p>
                    <p class="stat-label">Time</p>
                </div>
            </div>

            <div class="completion-actions">
                <button class="btn-secondary" onclick="window.location.href='index.html'">Back to Dashboard</button>
                <button class="btn-primary" onclick="nextExercise()">Next Exercise</button>
            </div>
        </div>
    </div>
</body>
</html>

